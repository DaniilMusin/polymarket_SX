#!/usr/bin/env python3
"""
–ì–ª—É–±–æ–∫–∏–π –ø–æ–∏—Å–∫ –≤—Å–µ—Ö –±–∞–≥–æ–≤ –≤ –∫–æ–¥–µ
"""

print("=" * 80)
print("–ì–õ–£–ë–û–ö–ò–ô –ü–û–ò–°–ö –í–°–ï–• –ë–ê–ì–û–í")
print("=" * 80)
print()

print("=" * 80)
print("–ë–ê–ì #5: NONCE COLLISION –≤ trader.py")
print("=" * 80)
print()
print("–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ: core/trader.py:103")
print("–ö–æ–¥:")
print("  nonce = int(time.time() * 1000)")
print()
print("–ü—Ä–æ–±–ª–µ–º–∞:")
print("  –ï—Å–ª–∏ –¥–≤–∞ –æ—Ä–¥–µ—Ä–∞ —Å–æ–∑–¥–∞—é—Ç—Å—è –±—ã—Å—Ç—Ä–æ (–≤ –ø—Ä–µ–¥–µ–ª–∞—Ö 1–º—Å), –æ–Ω–∏ –ø–æ–ª—É—á–∞—Ç")
print("  –û–î–ò–ù–ê–ö–û–í–´–ô nonce! –≠—Ç–æ –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—é –≤—Ç–æ—Ä–æ–≥–æ –æ—Ä–¥–µ—Ä–∞.")
print()
print("–í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ:")
print("  # –°–æ–∑–¥–∞–µ–º –¥–≤–∞ –æ—Ä–¥–µ—Ä–∞ –±—ã—Å—Ç—Ä–æ")
print("  order1 = place_order(...) # nonce = 1234567890123")
print("  order2 = place_order(...) # nonce = 1234567890123 (–û–î–ò–ù–ê–ö–û–í–´–ô!)")
print("  # –í—Ç–æ—Ä–æ–π –æ—Ä–¥–µ—Ä –±—É–¥–µ—Ç –æ—Ç–∫–ª–æ–Ω–µ–Ω –±–∏—Ä–∂–µ–π")
print()
print("–†–µ—à–µ–Ω–∏–µ:")
print("  1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—á–µ—Ç—á–∏–∫ –≤–º–µ—Å—Ç–æ –≤—Ä–µ–º–µ–Ω–∏")
print("  2. –î–æ–±–∞–≤–∏—Ç—å random component")
print("  3. –ü–æ–ª—É—á–∞—Ç—å nonce —Å API –±–∏—Ä–∂–∏")
print()

print("=" * 80)
print("–ë–ê–ì #6: SALT COLLISION –≤ wallet.py")
print("=" * 80)
print()
print("–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ: core/wallet.py:240")
print("–ö–æ–¥:")
print("  salt = int(time.time() * 1000)")
print()
print("–ü—Ä–æ–±–ª–µ–º–∞:")
print("  –¢–æ –∂–µ —Å–∞–º–æ–µ —á—Ç–æ –∏ —Å nonce - –∫–æ–ª–ª–∏–∑–∏–∏ –ø—Ä–∏ –±—ã—Å—Ç—Ä–æ–º —Å–æ–∑–¥–∞–Ω–∏–∏ –æ—Ä–¥–µ—Ä–æ–≤")
print()
print("–†–µ—à–µ–Ω–∏–µ:")
print("  import random")
print("  salt = int(time.time() * 1000) + random.randint(0, 1000000)")
print()

print("=" * 80)
print("–ë–ê–ì #7: –ù–ï–ë–ï–ó–û–ü–ê–°–ù–ê–Ø –ö–û–ù–í–ï–†–¢–ê–¶–ò–Ø tokenId")
print("=" * 80)
print()
print("–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ: core/wallet.py:247")
print("–ö–æ–¥:")
print("  'tokenId': int(token_id, 16) if isinstance(token_id, str) else token_id")
print()
print("–ü—Ä–æ–±–ª–µ–º–∞:")
print("  - –ß—Ç–æ –µ—Å–ª–∏ token_id - —Å—Ç—Ä–æ–∫–∞, –Ω–æ –ù–ï hex? ValueError!")
print("  - –ß—Ç–æ –µ—Å–ª–∏ token_id - –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ —á–∏—Å–ª–æ?")
print("  - –ù–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ñ–æ—Ä–º–∞—Ç–∞")
print()
print("–†–µ—à–µ–Ω–∏–µ:")
print("  try:")
print("      if isinstance(token_id, str):")
print("          token_id = int(token_id, 16)")
print("      if token_id < 0:")
print("          raise ValueError('tokenId must be non-negative')")
print("  except ValueError as e:")
print("      raise WalletError(f'Invalid tokenId: {token_id}') from e")
print()

print("=" * 80)
print("–ë–ê–ì #8: –õ–û–ì–ò–†–û–í–ê–ù–ò–ï –ü–†–ò–í–ê–¢–ù–û–ì–û –ö–õ–Æ–ß–ê")
print("=" * 80)
print()
print("–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ: core/wallet.py:60, 156-157")
print()
print("–ö–æ–¥:")
print("  logging.info('Wallet initialized: %s', self.address)")
print("  logging.warning('Created new wallet: %s (SAVE THE PRIVATE KEY!)', account.address)")
print()
print("–ü—Ä–æ–±–ª–µ–º–∞:")
print("  –û–¢–°–£–¢–°–¢–í–£–ï–¢ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞ –ø—Ä–∏ create_random_wallet!")
print("  –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–µ—Ç –∫–æ—à–µ–ª–µ–∫, –Ω–æ –Ω–µ –≤–∏–¥–∏—Ç –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á –≤ –ª–æ–≥–∞—Ö.")
print("  –ö–ª—é—á –ü–û–¢–ï–†–Ø–ù –Ω–∞–≤—Å–µ–≥–¥–∞!")
print()
print("–†–µ—à–µ–Ω–∏–µ:")
print("  logging.warning('PRIVATE KEY: %s (SAVE THIS!)', account.key.hex())")
print()

print("=" * 80)
print("–ë–ê–ì #9: RACE CONDITION –≤ execute_arbitrage_trade")
print("=" * 80)
print()
print("–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ: core/trader.py:462-488")
print()
print("–ü—Ä–æ–±–ª–µ–º–∞:")
print("  –î–≤–∞ –æ—Ä–¥–µ—Ä–∞ —Ä–∞–∑–º–µ—â–∞—é—Ç—Å—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ:")
print("  1. BUY order")
print("  2. SELL order")
print()
print("  –ß—Ç–æ –µ—Å–ª–∏ BUY –∏—Å–ø–æ–ª–Ω–∏–ª—Å—è, –Ω–æ SELL —É–ø–∞–ª —Å –æ—à–∏–±–∫–æ–π?")
print("  –†–µ–∑—É–ª—å—Ç–∞—Ç: –û–î–ù–û–°–¢–û–†–û–ù–ù–Ø–Ø –ü–û–ó–ò–¶–ò–Ø –±–µ–∑ —Ö–µ–¥–∂–∞!")
print("  –≠—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ —É–±—ã—Ç–∫–∞–º!")
print()
print("–†–µ—à–µ–Ω–∏–µ:")
print("  1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å asyncio.gather() –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–≥–æ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è")
print("  2. –î–æ–±–∞–≤–∏—Ç—å rollback –º–µ—Ö–∞–Ω–∏–∑–º")
print("  3. –ü—Ä–æ–≤–µ—Ä—è—Ç—å –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–±–æ–∏—Ö –æ—Ä–¥–µ—Ä–æ–≤")
print()

print("=" * 80)
print("–ë–ê–ì #10: –ù–ï–¢ –ü–†–û–í–ï–†–ö–ò EXECUTION –≤ execute_arbitrage_trade")
print("=" * 80)
print()
print("–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ: core/trader.py:456-488")
print()
print("–ü—Ä–æ–±–ª–µ–º–∞:")
print("  –ü–æ—Å–ª–µ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –æ—Ä–¥–µ—Ä–æ–≤ –ù–ï–¢ –ø—Ä–æ–≤–µ—Ä–∫–∏, —á—Ç–æ –æ–Ω–∏ –ò–°–ü–û–õ–ù–ò–õ–ò–°–¨!")
print("  IOC –æ—Ä–¥–µ—Ä –º–æ–∂–µ—Ç:")
print("    - –ò—Å–ø–æ–ª–Ω–∏—Ç—å—Å—è —á–∞—Å—Ç–∏—á–Ω–æ")
print("    - –ë—ã—Ç—å –æ—Ç–º–µ–Ω–µ–Ω (–Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏)")
print("    - –£–ø–∞—Å—Ç—å —Å –æ—à–∏–±–∫–æ–π")
print()
print("  –ù–æ –±–æ—Ç –≤—Å–µ —Ä–∞–≤–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ—Ç PnL –∫–∞–∫ –±—É–¥—Ç–æ –æ—Ä–¥–µ—Ä –∏—Å–ø–æ–ª–Ω–∏–ª—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é!")
print()
print("–¢–µ–∫—É—â–∏–π –∫–æ–¥:")
print("  buy_order = await place_order_polymarket(...)")
print("  # –ù–ï–¢ –ü–†–û–í–ï–†–ö–ò buy_order['status'] == 'filled'!")
print("  update_pnl(opportunity['expected_pnl'])  # –û–±–Ω–æ–≤–ª—è–µ–º PnL –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏!")
print()
print("–†–µ—à–µ–Ω–∏–µ:")
print("  if buy_order.get('status') != 'filled':")
print("      raise TradeExecutionError('Buy order not filled')")
print("  if sell_order.get('status') != 'filled':")
print("      raise TradeExecutionError('Sell order not filled')")
print()

print("=" * 80)
print("–ë–ê–ì #11: INCORRECT FEE CALCULATION")
print("=" * 80)
print()
print("–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ: core/processor.py:119")
print("–ö–æ–¥:")
print("  fees = 0.002  # Assume 0.1% fee per side = 0.002 total")
print()
print("–ü—Ä–æ–±–ª–µ–º–∞:")
print("  0.002 = 0.2%, –ù–ï 0.1% per side!")
print("  0.1% per side = 0.001 per side")
print("  Total = 0.001 + 0.001 = 0.002 ‚úì")
print()
print("  –ù–û –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π!")
print("  0.1% –æ—Ç $100 = $0.10")
print("  0.002 * $100 = $0.20")
print()
print("–ü—Ä–∞–≤–∏–ª—å–Ω–æ:")
print("  fees = 0.002  # 0.2% total (0.1% per side)")
print()

print("=" * 80)
print("–ë–ê–ì #12: –û–¢–°–£–¢–°–¢–í–£–ï–¢ –ü–†–û–í–ï–†–ö–ê –û–¢–í–ï–¢–ê API")
print("=" * 80)
print()
print("–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ: core/trader.py:137-139, connectors/*.py")
print()
print("–ü—Ä–æ–±–ª–µ–º–∞:")
print("  result = await resp.json()")
print("  logging.info('Order placed: %s', result.get('orderID', 'unknown'))")
print()
print("  –ß—Ç–æ –µ—Å–ª–∏:")
print("  - resp.json() –≤–µ—Ä–Ω—É–ª –ø—É—Å—Ç–æ–π dict?")
print("  - resp.json() –≤–µ—Ä–Ω—É–ª {'error': 'Insufficient funds'}?")
print("  - resp.json() –≤—ã–∑–≤–∞–ª JSONDecodeError (–Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π JSON)?")
print()
print("  –ë–æ—Ç –ª–æ–≥–∏—Ä—É–µ—Ç 'Order placed: unknown' –Ω–æ –æ—Ä–¥–µ—Ä –ù–ï —Ä–∞–∑–º–µ—â–µ–Ω!")
print()
print("–†–µ—à–µ–Ω–∏–µ:")
print("  result = await resp.json()")
print("  if 'error' in result:")
print("      raise TradeExecutionError(f\"API error: {result['error']}\")")
print("  if not result.get('orderID'):")
print("      raise TradeExecutionError('No orderID in response')")
print()

print("=" * 80)
print("–ë–ê–ì #13: TIMEOUT –°–õ–ò–®–ö–û–ú –ö–û–†–û–¢–ö–ò–ô")
print("=" * 80)
print()
print("–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ: –≤—Å–µ connectors")
print("–ö–æ–¥:")
print("  timeout = aiohttp.ClientTimeout(total=10.0)")
print()
print("–ü—Ä–æ–±–ª–µ–º–∞:")
print("  10 —Å–µ–∫—É–Ω–¥ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è:")
print("  - –ú–µ–¥–ª–µ–Ω–Ω–æ–π —Å–µ—Ç–∏")
print("  - –ó–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–π –±–∏—Ä–∂–∏")
print("  - Polygon RPC –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏")
print()
print("  –ü—Ä–∏ timeout –æ—Ä–¥–µ—Ä –ú–û–ñ–ï–¢ –±—ã—Ç—å —Ä–∞–∑–º–µ—â–µ–Ω –Ω–∞ –±–∏—Ä–∂–µ,")
print("  –Ω–æ –±–æ—Ç –ø–æ–ª—É—á–∏—Ç timeout –∏ –ø–æ–¥—É–º–∞–µ—Ç —á—Ç–æ –æ—Ä–¥–µ—Ä —É–ø–∞–ª!")
print("  –†–µ–∑—É–ª—å—Ç–∞—Ç: –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ä–¥–µ—Ä–æ–≤ –∏–ª–∏ –Ω–µ—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ")
print()
print("–†–µ—à–µ–Ω–∏–µ:")
print("  timeout = aiohttp.ClientTimeout(total=30.0)  # –ú–∏–Ω–∏–º—É–º 30 —Å–µ–∫")
print()

print("=" * 80)
print("–ò–¢–û–ì–û –ù–ê–ô–î–ï–ù–û:")
print("=" * 80)
print()
print("üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï:")
print("  #5  - Nonce collision (–¥–≤–∞ –æ—Ä–¥–µ—Ä–∞ = –æ–¥–∏–Ω nonce)")
print("  #6  - Salt collision (—Ç–∞ –∂–µ –ø—Ä–æ–±–ª–µ–º–∞)")
print("  #9  - Race condition (–æ–¥–∏–Ω –æ—Ä–¥–µ—Ä –∏—Å–ø–æ–ª–Ω–µ–Ω, –¥—Ä—É–≥–æ–π –Ω–µ—Ç)")
print("  #10 - –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ execution (PnL –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏)")
print()
print("üü† –í–´–°–û–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢:")
print("  #7  - –ù–µ–±–µ–∑–æ–ø–∞—Å–Ω–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è tokenId")
print("  #8  - –ü–æ—Ç–µ—Ä—è –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏")
print("  #12 - –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—Ç–≤–µ—Ç–∞ API")
print("  #13 - Timeout —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π")
print()
print("üü° –°–†–ï–î–ù–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢:")
print("  #11 - –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π fees (–Ω–µ –±–∞–≥, –Ω–æ misleading)")
print()
print("–í–°–ï–ì–û: 9 –Ω–æ–≤—ã—Ö –±–∞–≥–æ–≤ (4 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö, 4 –≤—ã—Å–æ–∫–∏—Ö, 1 —Å—Ä–µ–¥–Ω–∏–π)")
print("=" * 80)
